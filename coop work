#include <stdio.h>
#include <windows.h>
#include <conio.h>
#include <string.h>

typedef struct 
{
    int code;
    char way[40];
    char date[12];
    char time[6];
    int place;
}BOOKEDTICKET;


void usermenu ();
void findticket ();

int main()
{
    SetConsoleCP(1251);  
    SetConsoleOutputCP(1251);

    usermenu ();
    getch();
    return 0;
}

void usermenu ()
{
    int continuekey;
    //do
    //{
        continuekey = 0;
        printf("\n\t\t\033[3;38;5;2mМеню\033[0m\n");
        printf("1. Пошук квитків");
        char keymenu;
        keymenu = getche();
        switch (keymenu)
        {
        case 49:
            system("cls");
            findticket();
            break;

        
        default:
            system("cls");
            printf("\n\t\033[0;38;5;1mПомилка. Введіть корректний пункт меню\033[0m\n");
            continuekey++;
            break;
        }
    //}
    //while (continuekey == 1);
}

void findticket ()
{   BOOKEDTICKET *readyticket;
    readyticket = (BOOKEDTICKET*) calloc(10,sizeof(BOOKEDTICKET));
    if (readyticket == NULL)
        printf("\nПомилка, не вдалося виділити пам'ять");
    else
    {
        for (int i = 0; i < 1; i++)
        {
            system("cls");
            point1:
            printf ("\n\tОберіть один із запропонованих напрямків:");
            printf ("\n1. Київ - Львів");
            printf ("\n2. Київ - Одеса");
            printf ("\n3. Київ - Запоріжжя");
            printf ("\n4. Київ - Дніпро");
            printf ("\n0. Повернутися до головного меню\n");
            int wayticket, waycode, dateticket, datecode, timeticket, timecode, placeticket;
            int *ticket;
            ticket = (int *)calloc(4200, sizeof(int));

            // Перевірка успішності виділення пам'яті
            if (ticket == NULL) {
                printf("\nПомилка виділення пам'яті!");
            }
            else
            {
                scanf("%d",&wayticket);
                switch (wayticket)
                {
                case 1:
                    waycode = 0;
                    strcpy(readyticket[i].way, "Київ - Львів");
                    system("cls");
                    break;
                case 2:
                    waycode = 1050;
                    strcpy(readyticket[i].way, "Київ - Одеса");
                    system("cls");
                    break;
                case 3:
                    waycode = 2100;
                    strcpy(readyticket[i].way, "Київ - Запоріжжя");
                    system("cls");
                    break;
                case 4:
                    waycode = 3150;
                    strcpy(readyticket[i].way, "Київ - Дніпро");
                    system("cls");
                    break;
                case 0:
                    system("cls");
                    usermenu ();
                    break;
                default:
                    system("cls");
                    printf("\n\t\033[0;38;5;1mПомилка. Введіть корректний пункт меню\033[0m\n");
                    goto point1; //повернення до 57 рядка
                    break;
                }
                point2:
                printf ("\n\tОберіть дату");
                printf ("\n1. Пн, 24.07");
                printf ("\n2. Вт, 25.07");
                printf ("\n3. Ср, 26.07");
                printf ("\n4. Чт, 27.07");
                printf ("\n5. Пт, 28.07");
                printf ("\n6. Сб, 29.07");
                printf ("\n7. Нд, 30.07");
                printf ("\n9. Повернутися назад");
                printf ("\n0. Повернутися до головного меню\n");
                scanf("%d", &dateticket);
                switch (dateticket)
                {
                case 1:
                    datecode = 0;
                    strcpy(readyticket[i].date, "Пн, 24.07");
                    system("cls");
                    break;
                case 2:
                    datecode = 150;
                    strcpy(readyticket[i].date, "Вт, 25.07");
                    system("cls");
                    break;
                case 3:
                    datecode = 300;
                    strcpy(readyticket[i].date, "Ср, 26.07");
                    system("cls");
                    break;
                case 4:
                    datecode = 450;
                    strcpy(readyticket[i].date, "Чт, 27.07");
                    system("cls");
                    break;
                case 5:
                    datecode = 600;
                    strcpy(readyticket[i].date, "Пт, 28.07");
                    system("cls");
                    break;
                case 6:
                    datecode = 750;
                    strcpy(readyticket[i].date, "Сб, 29.07");
                    system("cls");
                    break;
                case 7:
                    datecode = 900;
                    strcpy(readyticket[i].date, "Нд, 30.07");
                    system("cls");
                    break;
                case 9:
                    system("cls");
                    goto point1; //повернення до 57 рядка
                    break;
                case 0:
                    system("cls");
                    usermenu ();
                    break;
                default:
                    system("cls");
                    printf("\n\t\033[0;38;5;1mПомилка. Введіть корректний пункт меню\033[0m\n");
                    goto point2; //повернення до 103 рядка
                    break;
                }


                point3:
                printf ("\n\tОберіть час");
                printf ("\n1. 9:02");
                printf ("\n2. 12:31");
                printf ("\n3. 15:48");
                printf ("\n4. 17:12");
                printf ("\n5. 22:08");
                printf ("\n9. Повернутися назад");
                printf ("\n0. Повернутися до головного меню\n");
                scanf("%d", &timeticket);
                switch (timeticket)
                {
                case 1:
                    timecode = 0; 
                    strcpy(readyticket[i].time, "9:02");
                    system("cls");
                    break;
                case 2:
                    timecode = 30;
                    strcpy(readyticket[i].time, "12:31");
                    system("cls");
                    break;
                case 3:
                    timecode = 60;
                    strcpy(readyticket[i].time, "15:48");
                    system("cls");
                    break;
                case 4:
                    timecode = 90;
                    strcpy(readyticket[i].time, "17:12");
                    system("cls");
                    break;
                case 5:
                    timecode = 120;
                    strcpy(readyticket[i].time, "22:08");
                    system("cls");
                    break;
                case 9:
                    system("cls");
                    goto point1; //повернення до 57 рядка
                    break;
                case 0:
                    system("cls");
                    usermenu ();
                    break;
                default:
                    system("cls");
                    printf("\n\t\033[0;38;5;1mПомилка. Введіть корректний пункт меню\033[0m\n");
                    goto point3; //повернення до 161 рядка
                    break;
                }

                do 
                {
                    printf ("\n\tОберіть місце 1 - 30: ");
                    scanf ("%d", &placeticket);
                    readyticket[i].place = placeticket;
                }
                while (placeticket < 1 || placeticket > 30);
        

                int indexticket;
                indexticket = waycode + datecode + timecode + placeticket;
                ticket[indexticket] = 1;
                printf("\nБілет №%d = %d\n%s\n%s", indexticket, ticket[indexticket], readyticket[i].way, readyticket[i].date);
            }
        }
    }

}
